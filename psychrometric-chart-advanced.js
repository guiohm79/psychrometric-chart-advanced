var PsychrometricChart=function(t){"use strict";function e(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&o.firstChild?o.insertBefore(n,o.firstChild):o.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}e("@keyframes fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.psychro-card{padding:16px;text-align:center}.psychro-card h2{margin-bottom:16px;margin-top:0}.chart-container{align-items:center;display:flex;justify-content:center;position:relative;width:100%}#psychroChart{cursor:crosshair;height:auto;max-width:100%;transition:all .3s ease}.legend-container{backdrop-filter:blur(10px);background:hsla(0,0%,100%,.95);border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.15);font-size:12px;max-width:200px;padding:12px;position:absolute;right:10px;top:10px;z-index:10}.legend-container.dark{background:rgba(45,45,45,.95)}.legend-item{align-items:center;display:flex;gap:8px;margin:6px 0}.legend-color{border-radius:3px;flex-shrink:0;height:12px;width:20px}.legend-label{font-size:11px;line-height:1.2}.chart-tooltip{background:rgba(0,0,0,.85);border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.3);color:#fff;font-size:12px;padding:8px 12px;pointer-events:none;position:absolute;white-space:nowrap;z-index:100}.chart-tooltip.dark{background:hsla(0,0%,100%,.9);color:#333}@media (max-width:768px){.psychro-card{padding:12px}.psychro-card h2{font-size:18px}.legend-container{margin:10px auto;max-width:100%;position:static}#psychroChart{max-width:100%}}@media (max-width:480px){.psychro-card{padding:8px}.legend-container{font-size:11px;padding:8px}}");e('.psychro-data{display:grid;font-size:14px;gap:20px;grid-template-columns:repeat(auto-fit,minmax(min(100%,300px),1fr));margin-left:auto;margin-right:auto;margin-top:20px;max-width:100%;padding:0 20px;text-align:left}.psychro-point-data{backdrop-filter:blur(10px);border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);cursor:pointer;overflow:hidden;padding:15px;position:relative;transition:all .3s cubic-bezier(.4,0,.2,1)}.psychro-point-data.light{background:linear-gradient(135deg,#fff,#f5f5f5)}.psychro-point-data.dark{background:linear-gradient(135deg,#2d2d2d,#1a1a1a);box-shadow:0 4px 15px rgba(0,0,0,.3)}.psychro-point-data:hover{transform:translateY(-5px)}.psychro-point-data.light:hover{box-shadow:0 8px 25px rgba(0,0,0,.15)}.psychro-point-data.dark:hover{box-shadow:0 8px 25px rgba(0,0,0,.5)}.psychro-point-data:before{background:radial-gradient(circle at top right,currentColor,transparent);bottom:0;content:"";left:0;opacity:.05;pointer-events:none;position:absolute;right:0;top:0}.psychro-point-header{align-items:center;display:flex;margin-bottom:10px;position:relative;z-index:1}.psychro-point-header ha-icon{margin-right:8px}.psychro-point-label{font-size:16px;font-weight:700}.psychro-comfort-badge{border-radius:15px;box-shadow:0 2px 8px rgba(0,0,0,.3);color:#fff;font-size:11px;margin-left:auto;padding:4px 10px}.psychro-comfort-badge.optimal{background:linear-gradient(135deg,#4caf50,#45a049)}.psychro-comfort-badge.outside{background:linear-gradient(135deg,#ff9800,#f57c00)}.psychro-point-content{position:relative;z-index:1}.psychro-data-grid{display:grid;gap:10px;grid-template-columns:1fr 1fr}.psychro-data-item{border-radius:5px;margin-bottom:5px;padding:5px;transition:background .2s}.psychro-data-item.clickable{cursor:pointer}.psychro-data-item.clickable:hover{transform:scale(1.02)}.psychro-data-item.clickable.light:hover{background:rgba(0,0,0,.05)}.psychro-data-item.clickable.dark:hover{background:hsla(0,0%,100%,.1)}.psychro-data-item strong{display:inline-block;margin-right:4px}.psychro-data-value{font-weight:600}.psychro-action-section{margin-top:15px;padding-top:10px}.psychro-action-section.light{border-top:1px solid #ddd}.psychro-action-section.dark{border-top:1px solid #555}@media (max-width:768px){.psychro-data{padding:0 10px}.psychro-data,.psychro-data-grid{grid-template-columns:1fr}.psychro-point-data{padding:12px}.psychro-point-label{font-size:14px}}@media (max-width:480px){.psychro-data{gap:15px}.psychro-point-data{padding:10px}.psychro-data-item{font-size:13px}}');e("@keyframes modalSlideIn{0%{opacity:0;transform:scale(.9) translateY(-20px)}to{opacity:1;transform:scale(1) translateY(0)}}.modal-overlay{align-items:center;animation:fadeIn .3s ease;backdrop-filter:blur(5px);background:rgba(0,0,0,.7);bottom:0;display:flex;justify-content:center;left:0;position:fixed;right:0;top:0;z-index:9999}.modal-content{animation:modalSlideIn .4s cubic-bezier(.4,0,.2,1);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.3);max-height:90vh;max-width:90%;overflow-y:auto;padding:30px;position:relative}.modal-content.light{background:linear-gradient(135deg,#fff,#f8f9fa)}.modal-content.dark{background:linear-gradient(135deg,#2d2d2d,#1a1a1a)}.modal-close{align-items:center;border:none;border-radius:50%;cursor:pointer;display:flex;font-size:24px;height:40px;justify-content:center;position:absolute;right:15px;top:15px;transition:all .2s;width:40px}.modal-close.light{background:rgba(0,0,0,.1);color:#333}.modal-close.dark{background:hsla(0,0%,100%,.1);color:#fff}.modal-close:hover{transform:rotate(90deg)}.modal-close.light:hover{background:rgba(0,0,0,.2)}.modal-close.dark:hover{background:hsla(0,0%,100%,.2)}.modal-header{margin-bottom:20px;padding-right:50px}.modal-title{font-size:24px;font-weight:700;margin:0 0 10px}.modal-subtitle{font-size:14px;margin:0;opacity:.7}.history-chart{border-radius:10px;height:300px;margin-top:20px;overflow:hidden;width:100%}.history-chart canvas{height:100%;width:100%}.modal-loading{padding:40px;text-align:center}.modal-loading-spinner{animation:spin 1s linear infinite;border:4px solid rgba(0,0,0,.1);border-left-color:currentcolor;border-radius:50%;height:40px;margin:0 auto 16px;width:40px}@keyframes spin{to{transform:rotate(1turn)}}.modal-error{color:#f44336;padding:40px;text-align:center}.modal-error-icon{font-size:48px;margin-bottom:16px}.history-summary{display:grid;gap:15px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));margin:20px 0}.history-summary-item{border-radius:10px;padding:12px;text-align:center}.history-summary-item.light{background:rgba(0,0,0,.05)}.history-summary-item.dark{background:hsla(0,0%,100%,.05)}.history-summary-label{font-size:12px;margin-bottom:4px;opacity:.7}.history-summary-value{font-size:20px;font-weight:700}@media (max-width:768px){.modal-content{max-height:95vh;max-width:95%;padding:20px}.modal-title{font-size:20px}.history-chart{height:250px}.history-summary{grid-template-columns:1fr 1fr}}@media (max-width:480px){.modal-content{padding:15px}.modal-close{font-size:20px;height:35px;width:35px}.modal-title{font-size:18px}.history-chart{height:200px}.history-summary{grid-template-columns:1fr}}");const i={fr:{noPointsConfigured:"Aucun point ou entit√© configur√© dans la carte !",noValidEntity:"Aucune entit√© valide trouv√©e !",noDataAvailable:"Aucune donn√©e disponible",temperature:"Temp√©rature",humidity:"Humidit√©",dewPoint:"Point de ros√©e",wetBulbTemp:"Temp. humide",enthalpy:"Enthalpie",waterContent:"Teneur eau",absoluteHumidity:"Humidit√© abs.",specificVolume:"Vol. sp√©cifique",pmvIndex:"Indice PMV",moldRisk:"Moisissure",action:"Action",totalPower:"Puissance totale",heating:"Chauffage",cooling:"Refroidissement",humidification:"Humidification",dehumidification:"D√©shumidification",idealSetpoint:"Consigne id√©ale",optimalComfort:"Confort optimal",outsideComfort:"Hors confort",comfortZone:"Zone de confort",legend:"L√©gende",minimum:"Minimum",average:"Moyenne",maximum:"Maximum",clickToViewHistory:"Cliquer pour voir l'historique",warm:"R√©chauffer",cool:"Refroidir",andHumidify:"et Humidifier",andDehumidify:"et D√©shumidifier",historyLast24h:"Historique des derni√®res 24 heures",dataPoints:"points de donn√©es",moldRiskNone:"Aucun risque",moldRiskVeryLow:"Tr√®s faible",moldRiskLow:"Faible",moldRiskModerate:"Mod√©r√©",moldRiskHigh:"√âlev√©",moldRiskVeryHigh:"Tr√®s √©lev√©",moldRiskCritical:"Critique"},en:{noPointsConfigured:"No points or entities configured in the card!",noValidEntity:"No valid entities found!",noDataAvailable:"No data available",temperature:"Temperature",humidity:"Humidity",dewPoint:"Dew point",wetBulbTemp:"Wet bulb temp.",enthalpy:"Enthalpy",waterContent:"Water content",absoluteHumidity:"Absolute humidity",specificVolume:"Specific volume",pmvIndex:"PMV Index",moldRisk:"Mold risk",action:"Action",totalPower:"Total power",heating:"Heating",cooling:"Cooling",humidification:"Humidification",dehumidification:"Dehumidification",idealSetpoint:"Ideal setpoint",optimalComfort:"Optimal comfort",outsideComfort:"Outside comfort",comfortZone:"Comfort zone",legend:"Legend",minimum:"Minimum",average:"Average",maximum:"Maximum",clickToViewHistory:"Click to view history",warm:"Warm up",cool:"Cool down",andHumidify:"and Humidify",andDehumidify:"and Dehumidify",historyLast24h:"History of the last 24 hours",dataPoints:"data points",moldRiskNone:"No risk",moldRiskVeryLow:"Very low",moldRiskLow:"Low",moldRiskModerate:"Moderate",moldRiskHigh:"High",moldRiskVeryHigh:"Very high",moldRiskCritical:"Critical"},es:{noPointsConfigured:"¬°No hay puntos o entidades configuradas en la tarjeta!",noValidEntity:"¬°No se encontraron entidades v√°lidas!",noDataAvailable:"No hay datos disponibles",temperature:"Temperatura",humidity:"Humedad",dewPoint:"Punto de roc√≠o",wetBulbTemp:"Temp. h√∫meda",enthalpy:"Entalp√≠a",waterContent:"Contenido agua",absoluteHumidity:"Humedad abs.",specificVolume:"Vol. espec√≠fico",pmvIndex:"√çndice PMV",moldRisk:"Moho",action:"Acci√≥n",totalPower:"Potencia total",heating:"Calefacci√≥n",cooling:"Refrigeraci√≥n",humidification:"Humidificaci√≥n",dehumidification:"Deshumidificaci√≥n",idealSetpoint:"Consigna ideal",optimalComfort:"Confort √≥ptimo",outsideComfort:"Fuera de confort",comfortZone:"Zona de confort",legend:"Leyenda",minimum:"M√≠nimo",average:"Promedio",maximum:"M√°ximo",clickToViewHistory:"Haz clic para ver el historial",warm:"Calentar",cool:"Enfriar",andHumidify:"y Humidificar",andDehumidify:"y Deshumidificar",historyLast24h:"Historial de las √∫ltimas 24 horas",dataPoints:"puntos de datos",moldRiskNone:"Sin riesgo",moldRiskVeryLow:"Muy bajo",moldRiskLow:"Bajo",moldRiskModerate:"Moderado",moldRiskHigh:"Alto",moldRiskVeryHigh:"Muy alto",moldRiskCritical:"Cr√≠tico"},de:{noPointsConfigured:"Keine Punkte oder Entit√§ten in der Karte konfiguriert!",noValidEntity:"Keine g√ºltigen Entit√§ten gefunden!",noDataAvailable:"Keine Daten verf√ºgbar",temperature:"Temperatur",humidity:"Luftfeuchtigkeit",dewPoint:"Taupunkt",wetBulbTemp:"Feuchtkugeltemp.",enthalpy:"Enthalpie",waterContent:"Wassergehalt",absoluteHumidity:"Abs. Feuchtigkeit",specificVolume:"Spez. Volumen",pmvIndex:"PMV-Index",moldRisk:"Schimmel",action:"Aktion",totalPower:"Gesamtleistung",heating:"Heizung",cooling:"K√ºhlung",humidification:"Befeuchtung",dehumidification:"Entfeuchtung",idealSetpoint:"Idealer Sollwert",optimalComfort:"Optimaler Komfort",outsideComfort:"Au√üerhalb Komfort",comfortZone:"Komfortzone",legend:"Legende",minimum:"Minimum",average:"Durchschnitt",maximum:"Maximum",clickToViewHistory:"Klicken Sie, um den Verlauf anzuzeigen",warm:"Erw√§rmen",cool:"Abk√ºhlen",andHumidify:"und Befeuchten",andDehumidify:"und Entfeuchten",historyLast24h:"Verlauf der letzten 24 Stunden",dataPoints:"Datenpunkte",moldRiskNone:"Kein Risiko",moldRiskVeryLow:"Sehr niedrig",moldRiskLow:"Niedrig",moldRiskModerate:"M√§√üig",moldRiskHigh:"Hoch",moldRiskVeryHigh:"Sehr hoch",moldRiskCritical:"Kritisch"}};class o{constructor(t){this.language=t||"fr"}setLanguage(t){this.language=t}getLanguage(){return this.language}t(t){return i[this.language][t]||i.fr[t]||t}getAllTranslations(){return i[this.language]}}class n{constructor(t,e){this.zoomLevel=1,this.panX=0,this.panY=0,this.configuredZoomRange=null,this.minZoom=.5,this.maxZoom=3,this.canvasWidth=t,this.canvasHeight=e}setDimensions(t,e){this.canvasWidth=t,this.canvasHeight=e,this.configuredZoomRange&&this.calculateZoomFromRange()}setZoomRange(t){this.configuredZoomRange=t,t?this.calculateZoomFromRange():(this.zoomLevel=1,this.panX=0,this.panY=0)}calculateZoomFromRange(){if(!this.configuredZoomRange)return;const{tempMin:t,tempMax:e,humidityMin:i,humidityMax:o}=this.configuredZoomRange,n=e-t;this.zoomLevel=Math.min(this.maxZoom,Math.max(this.minZoom,60/n));const a=(t+e)/2,s=20-a;if(this.panX=12*s*(this.canvasWidth/800)*this.zoomLevel,null!==i&&null!==o){const t=(i+o)/2,e=a,n=.61078*Math.exp(17.27*e/(e+237.3)),s=(t/100*n-.5*n)/4*500*(this.canvasHeight/600);this.panY=s*this.zoomLevel}else this.panY=0}tempToX(t){const e=this.canvasWidth/800,i=50*e+12*(t+10)*e;if(1!==this.zoomLevel||0!==this.panX){const t=this.canvasWidth/2;return(i-t)*this.zoomLevel+t+this.panX}return i}humidityToY(t,e){const i=this.canvasHeight/600,o=550*i-e/100*(.61078*Math.exp(17.27*t/(t+237.3)))/4*500*i;if(1!==this.zoomLevel||0!==this.panY){const t=this.canvasHeight/2;return(o-t)*this.zoomLevel+t+this.panY}return o}xToTemp(t){const e=this.canvasWidth/800,i=this.canvasWidth/2;let o=t;return 1===this.zoomLevel&&0===this.panX||(o=(t-i-this.panX)/this.zoomLevel+i),(o/e-50)/12-10}yToHumidity(t,e){const i=this.canvasHeight/600,o=this.canvasHeight/2;let n=t;1===this.zoomLevel&&0===this.panY||(n=(t-o-this.panY)/this.zoomLevel+o);return(550*i-n)/(500*i)*4/(.61078*Math.exp(17.27*e/(e+237.3)))*100}getZoomLevel(){return this.zoomLevel}getPan(){return{x:this.panX,y:this.panY}}setZoomLevel(t){this.zoomLevel=Math.min(this.maxZoom,Math.max(this.minZoom,t))}setPan(t,e){this.panX=t,this.panY=e}getDimensions(){return{width:this.canvasWidth,height:this.canvasHeight}}isPointVisible(t,e){return t>=0&&t<=this.canvasWidth&&e>=0&&e<=this.canvasHeight}getVisibleTempRange(){return{min:this.xToTemp(0),max:this.xToTemp(this.canvasWidth)}}getVisibleHumidityRange(t){const e=this.yToHumidity(0,t),i=this.yToHumidity(this.canvasHeight,t);return{min:Math.max(0,i),max:Math.min(100,e)}}}class a{constructor(t){this.canvas=null,this.ctx=null,this.coordinateSystem=t}setCanvas(t){this.canvas=t,this.ctx=t.getContext("2d"),this.coordinateSystem.setDimensions(t.width,t.height)}draw(t,e){if(!this.canvas||!this.ctx)return void console.error("Canvas not set");const i=this.ctx,o=this.canvas.width,n=this.canvas.height,a=o/800,s=n/600,r=Math.min(a,s);i.fillStyle=e.bgColor,i.fillRect(0,0,o,n),this.drawGrid(i,e,r),this.drawHumidityCurves(i,e,r),e.showEnthalpy&&this.drawEnthalpyCurves(i,e,r),this.drawComfortZone(i,e),this.drawDataPoints(i,t,e,r),e.showDewPoint&&this.drawDewPointLines(i,t,e,r),e.showPointLabels&&this.drawPointLabels(i,t,e,r)}drawGrid(t,e,i){const o=this.canvas.width/800,n=this.canvas.height/600;t.strokeStyle=e.gridColor,t.lineWidth=1*i,t.setLineDash([5*i,5*i]),t.font=`${Math.max(10,12*i)}px Arial`;for(let i=0;i<=4;i+=.5){const a=20,s=i/(.61078*Math.exp(17.27*a/(a+237.3)))*100,r=this.coordinateSystem.humidityToY(a,s);t.beginPath(),t.moveTo(50*o,r),t.lineTo(750*o,r),t.stroke(),t.fillStyle=e.textColor,t.fillText(`${i.toFixed(1)} kPa`,10*o,r+5*n)}for(let i=-10;i<=50;i+=5){const a=this.coordinateSystem.tempToX(i);t.beginPath(),t.moveTo(a,550*n),t.lineTo(a,50*n),t.stroke(),t.fillStyle=e.textColor,t.fillText(`${i}¬∞C`,a-10*o,550*n+20*n)}t.setLineDash([])}drawHumidityCurves(t,e,i){t.font=`${Math.max(10,12*i)}px Arial`;for(let o=10;o<=100;o+=10){t.beginPath(),t.strokeStyle=100===o?"rgba(30, 144, 255, 0.8)":e.curveColor,t.lineWidth=(o%20==0?1.5:.8)*i;let n=0,a=0;for(let e=-10;e<=50;e++){const i=this.coordinateSystem.tempToX(e),s=this.coordinateSystem.humidityToY(e,o);-10===e?t.moveTo(i,s):t.lineTo(i,s),n=i,a=s}t.stroke(),o%20==0&&a>0&&(t.fillStyle=e.textColor,t.fillText(`${o}%`,n+5*i,a))}}drawEnthalpyCurves(t,e,i){t.strokeStyle=e.darkMode?"rgba(255, 165, 0, 0.4)":"rgba(255, 140, 0, 0.3)",t.lineWidth=.8*i,t.setLineDash([3*i,3*i]);for(let e=20;e<=100;e+=20){t.beginPath();let i=0;for(let o=-10;o<=50;o+=1)for(let n=10;n<=100;n+=5){const a=n/100*(.61078*Math.exp(17.27*o/(o+237.3))),s=1.006*o+a/(101.325-a)*.622*(2501+1.84*o);if(Math.abs(s-e)<2){const e=this.coordinateSystem.tempToX(o),a=this.coordinateSystem.humidityToY(o,n);0===i?t.moveTo(e,a):t.lineTo(e,a),i++}}i>0&&t.stroke()}t.setLineDash([])}drawComfortZone(t,e){const{comfortRange:i,comfortColor:o}=e;t.fillStyle=o,t.strokeStyle=e.darkMode?"rgba(76, 175, 80, 0.6)":"rgba(76, 175, 80, 0.4)",t.lineWidth=2,t.beginPath();let n=this.coordinateSystem.tempToX(i.tempMin),a=this.coordinateSystem.humidityToY(i.tempMin,i.rhMax);t.moveTo(n,a);for(let e=i.tempMin;e<=i.tempMax;e+=.5)n=this.coordinateSystem.tempToX(e),a=this.coordinateSystem.humidityToY(e,i.rhMax),t.lineTo(n,a);for(let e=i.rhMax;e>=i.rhMin;e-=1)n=this.coordinateSystem.tempToX(i.tempMax),a=this.coordinateSystem.humidityToY(i.tempMax,e),t.lineTo(n,a);for(let e=i.tempMax;e>=i.tempMin;e-=.5)n=this.coordinateSystem.tempToX(e),a=this.coordinateSystem.humidityToY(e,i.rhMin),t.lineTo(n,a);for(let e=i.rhMin;e<=i.rhMax;e+=1)n=this.coordinateSystem.tempToX(i.tempMin),a=this.coordinateSystem.humidityToY(i.tempMin,e),t.lineTo(n,a);t.closePath(),t.fill(),t.stroke()}drawDataPoints(t,e,i,o){e.forEach(e=>{const n=this.coordinateSystem.tempToX(e.temp),a=this.coordinateSystem.humidityToY(e.temp,e.humidity);t.beginPath(),t.arc(n,a,6*o,0,2*Math.PI),t.fillStyle=e.config.color,t.fill(),t.strokeStyle=i.darkMode?"#fff":"#000",t.lineWidth=2*o,t.stroke(),t.shadowColor=e.config.color,t.shadowBlur=10*o,t.beginPath(),t.arc(n,a,4*o,0,2*Math.PI),t.fillStyle=e.config.color,t.fill(),t.shadowBlur=0})}drawDewPointLines(t,e,i,o){e.forEach(e=>{const i=this.coordinateSystem.tempToX(e.temp),n=this.coordinateSystem.humidityToY(e.temp,e.humidity),a=this.coordinateSystem.tempToX(e.dewPoint),s=this.coordinateSystem.humidityToY(e.dewPoint,100);t.beginPath(),t.moveTo(i,n),t.lineTo(a,s),t.strokeStyle=e.config.color,t.lineWidth=1*o,t.setLineDash([3*o,3*o]),t.stroke(),t.setLineDash([])})}drawPointLabels(t,e,i,o){t.font=`bold ${Math.max(10,12*o)}px Arial`,t.textAlign="center",e.forEach(e=>{const n=this.coordinateSystem.tempToX(e.temp),a=this.coordinateSystem.humidityToY(e.temp,e.humidity),s=e.config.label,r=t.measureText(s),d=4*o;t.fillStyle=i.darkMode?"rgba(0, 0, 0, 0.7)":"rgba(255, 255, 255, 0.9)",t.fillRect(n-r.width/2-d,a-20*o-d,r.width+2*d,14*o+2*d),t.fillStyle=e.config.color,t.fillText(s,n,a-12*o)}),t.textAlign="left"}getCoordinateSystem(){return this.coordinateSystem}}class s{constructor(){this.hasRendered=!1}markRendered(){this.hasRendered=!0}reset(){this.hasRendered=!1}render(t,e){return function(t,e){const{textColor:i,darkMode:o,hasRendered:n,i18n:a}=e;return`\n        <div class="${o?"legend-container dark":"legend-container light"}" style="animation: ${n?"none":"fadeInUp 0.5s ease 0.3s backwards"};">\n            <div class="legend-title" style="color: ${i};">\n                üìç ${a.t("legend")}\n            </div>\n            ${t.map((t,e)=>function(t,e,i,o){return`\n        <div class="legend-item" style="animation: ${o?"none":`fadeInUp 0.3s ease ${.4+.1*e}s backwards`};">\n            <div class="legend-color" style="\n                background-color: ${t.config.color};\n                box-shadow: 0 2px 5px ${t.config.color}80;">\n            </div>\n            <span class="legend-label" style="color: ${i};">\n                ${t.config.label}\n            </span>\n        </div>\n    `}(t,e,i,n)).join("")}\n        </div>\n    `}(t,Object.assign(Object.assign({},e),{hasRendered:this.hasRendered}))}}function r(t){const{points:e,darkMode:i,displayMode:o,showMoldRisk:n,i18n:a,hasRendered:s}=t,r=i?"dark":"light";return`\n        <div class="psychro-data">\n            ${e.map((t,e)=>function(t,e,i,o,n,a,s){const r=s?"none":`fadeInUp 0.5s ease-out ${.1*e}s backwards`,h=t.inComfortZone?`<span class="psychro-comfort-badge optimal">‚úì ${a.t("optimalComfort")}</span>`:`<span class="psychro-comfort-badge outside">‚ö† ${a.t("outsideComfort")}</span>`;return`\n        <div class="psychro-point-data ${i}"\n             data-point-index="${e}"\n             style="border-left-color: ${t.config.color}; animation: ${r};">\n            <div class="psychro-point-header">\n                <ha-icon icon="${t.config.icon||"mdi:thermometer"}"></ha-icon>\n                <span class="psychro-point-label" style="color: ${t.config.color};">\n                    ${t.config.label}\n                </span>\n                ${h}\n            </div>\n            <div class="psychro-point-content">\n                <div class="psychro-data-grid">\n                    <div>\n                        ${d(a.t("temperature"),`${t.temp.toFixed(1)}¬∞C`,t.config.color,i,!0,t.config.temp,"temperature")}\n                        ${d(a.t("humidity"),`${t.humidity.toFixed(1)}%`,t.config.color,i,!0,t.config.humidity,"humidity")}\n                        ${"standard"===o||"advanced"===o?`\n                            ${d(a.t("dewPoint"),`${t.dewPoint.toFixed(1)}¬∞C`,"",i,!1)}\n                            ${d(a.t("wetBulbTemp"),`${t.wetBulbTemp.toFixed(1)}¬∞C`,"",i,!1)}\n                            ${d(a.t("enthalpy"),`${t.enthalpy.toFixed(1)} kJ/kg`,"",i,!1)}\n                        `:""}\n                    </div>\n                    <div>\n                        ${"standard"===o||"advanced"===o?`\n                            ${d(a.t("pmvIndex"),t.pmv.toFixed(2),"",i,!1)}\n                        `:""}\n                        ${"advanced"===o?`\n                            ${d(a.t("waterContent"),`${t.waterContent.toFixed(4)} kg/kg`,"",i,!1)}\n                            ${d(a.t("absoluteHumidity"),`${t.absoluteHumidity.toFixed(2)} g/m¬≥`,"",i,!1)}\n                            ${d(a.t("specificVolume"),`${t.specificVolume.toFixed(3)} m¬≥/kg`,"",i,!1)}\n                            ${n?function(t,e,i){const o=["moldRiskNone","moldRiskVeryLow","moldRiskLow","moldRiskModerate","moldRiskHigh","moldRiskVeryHigh","moldRiskCritical"],n=Math.min(Math.floor(t),6),a=e.t(o[n]),s="dark"===i?["#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722"]:["#2E7D32","#558B2F","#9E9D24","#F9A825","#EF6C00","#E65100","#C62828"];return`\n        <div class="psychro-data-item">\n            <strong>ü¶† ${e.t("moldRisk")}:</strong>\n            <span class="psychro-data-value" style="color: ${s[n]}; font-weight: 600;">${a}</span>\n        </div>\n    `}(t.moldRisk,a,i):""}\n                        `:""}\n                    </div>\n                </div>\n                \n            </div>\n        </div>\n    `}(t,e,r,o,n,a,s)).join("")}\n        </div>\n    `}function d(t,e,i,o,n,a,s){return`\n        <div class="${n?`psychro-data-item clickable ${o}`:"psychro-data-item"}" ${n&&a&&s?`data-entity="${a}" data-type="${s}"`:""}>\n            <strong>üå°Ô∏è ${t}:</strong>\n            <span class="psychro-data-value" ${i?`style="color: ${i};"`:""}>${e}</span>\n        </div>\n    `}function h(t,e){const i=17.27*t/(237.3+t)+Math.log(e/100);return 237.3*i/(17.27-i)}function l(t,e){const i=e/100*(.61078*Math.exp(17.27*t/(t+237.3)));return i/(101.325-i)*.622}function c(t,e){const i=t+273.15,o=function(t,e){return.61078*Math.exp(17.27*t/(t+237.3))*(e/100)}(t,e);return 287.058*i/(101.325-o)*(1+1.608*l(t,e))}const m={tempMin:20,tempMax:24,rhMin:40,rhMax:60};function p(t,e,i){return t>=i.tempMin&&t<=i.tempMax&&e>=i.rhMin&&e<=i.rhMax}function u(t,e=0){const i=parseFloat(t);return isNaN(i)?e:i}class g extends HTMLElement{constructor(){var t,e,i;super(),this._hass=null,this._hasRendered=!1,this._previousValues=new Map,this.canvasWidth=800,this.canvasHeight=600,this.resizeObserver=null,this.resizeDebounceTimer=null,this.validPoints=[],this.i18n=new o("fr"),this.coordinateSystem=(t=this.canvasWidth,e=this.canvasHeight,new n(t,e)),this.chartRenderer=(i=this.coordinateSystem,new a(i)),this.legendRenderer=new s}setConfig(t){if(!t.points||0===t.points.length)throw new Error(this.i18n.t("noPointsConfigured"));if(this.config=t,t.language&&this.i18n.setLanguage(t.language),void 0!==t.zoom_temp_min&&void 0!==t.zoom_temp_max){const e={tempMin:t.zoom_temp_min,tempMax:t.zoom_temp_max,humidityMin:t.zoom_humidity_min||0,humidityMax:t.zoom_humidity_max||100};this.coordinateSystem.setZoomRange(e)}}set hass(t){const e=this._hass;this._hass=t,e&&this.shouldUpdate(t)?this.render(t):e||this.render(t)}get hass(){return this._hass}shouldUpdate(t){if(!this.config||!this.config.points)return!1;for(const e of this.config.points){const i=t.states[e.temp],o=t.states[e.humidity];if(!i||!o)continue;const n=this._previousValues.get(e.temp),a=this._previousValues.get(e.humidity);if(i.state!==n||o.state!==a)return!0}return!1}storeSensorValues(t){if(this.config&&this.config.points)for(const e of this.config.points){const i=t.states[e.temp],o=t.states[e.humidity];i&&this._previousValues.set(e.temp,i.state),o&&this._previousValues.set(e.humidity,o.state)}}render(t){if(this.validPoints=this.processPoints(t),0===this.validPoints.length)return void(this.innerHTML=`<p style="color: red;">${this.i18n.t("noValidEntity")}</p>`);const{bgColor:e="#ffffff",gridColor:i="#cccccc",curveColor:o="#1f77b4",textColor:n="#333333",chartTitle:a="Diagramme Psychrom√©trique",showCalculatedData:s=!0,comfortRange:d=m,comfortColor:h="rgba(144, 238, 144, 0.5)",showEnthalpy:l=!1,showLegend:c=!0,darkMode:p=!1,showMoldRisk:u=!0,displayMode:g="standard",showPointLabels:f=!1}=this.config,y=p?"#121212":e,x=p?"#ffffff":n,v=p?"#333333":i,b=c?this.legendRenderer.render(this.validPoints,{textColor:x,darkMode:p,i18n:this.i18n}):"",w=s?r({points:this.validPoints,darkMode:p,displayMode:g,showMoldRisk:u,i18n:this.i18n,hasRendered:this._hasRendered}):"";this.innerHTML=function(t){const e=t.hasRendered?"none":"fadeInUp 0.5s ease";return`\n        <ha-card>\n            <div class="psychro-card" style="background-color: ${t.bgColor}; color: ${t.textColor};">\n                <h2 style="animation: ${e};">${t.title}</h2>\n                <div class="chart-container">\n                    <canvas id="psychroChart" width="${t.canvasWidth}" height="${t.canvasHeight}"></canvas>\n                    ${t.legendHTML}\n                </div>\n                ${t.calculatedDataHTML}\n            </div>\n        </ha-card>\n        <div id="historyModal" style="display: none;"></div>\n    `}({title:a,bgColor:y,textColor:x,canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight,legendHTML:b,calculatedDataHTML:w,hasRendered:this._hasRendered}),this.storeSensorValues(t),this._hasRendered||(this._hasRendered=!0,this.legendRenderer.markRendered()),this.drawChart({bgColor:y,gridColor:v,curveColor:o,textColor:x,comfortRange:d,comfortColor:h,showEnthalpy:l,darkMode:p,showPointLabels:f}),this.setupEventListeners()}processPoints(t){const e=this.config.comfortRange||m;return this.config.points.map(i=>this.processPoint(i,t,e)).filter(t=>null!==t)}processPoint(t,e,i){const o=e.states[t.temp],n=e.states[t.humidity];if(!o||!n)return console.warn(`Entities not available: ${t.temp} or ${t.humidity}`),null;const a=u(o.state),s=u(n.state),r=h(a,s),d=l(a,s),m=function(t,e){return 1.006*t+e*(2501+1.84*t)}(a,d),g=function(t,e){return e/100*(.61078*Math.exp(17.27*t/(t+237.3)))*1e3/(461.5*(t+273.15))*1e3}(a,s),f=function(t,e){return t*Math.atan(.151977*Math.pow(e+8.313659,.5))+Math.atan(t+e)-Math.atan(e-1.676331)+.00391838*Math.pow(e,1.5)*Math.atan(.023101*e)-4.686035}(a,s),y=c(a,s),x=function(t,e){let i=0;return t<5?i+=0:t>=5&&t<15?i+=1:t>=15&&t<20?i+=2:t>=20&&t<25?i+=3:t>=25&&(i+=2.5),e<60?i+=0:e>=60&&e<70?i+=1:e>=70&&e<80?i+=2:e>=80&&e<90?i+=2.5:e>=90&&(i+=3),h(t,e)>12&&(i+=.5),Math.min(i,6)}(a,s),v=function(t,e){const i=t,o=t,n=69.78,a=e/100*10*Math.exp(16.6536-4030.183/(i+235));let s=.303*Math.exp(-.036*n)+.028;return s*=n-58.15-8.3076-.0173*n*(5.87-a)-.097692*(34-i)-3.96*Math.pow(10,-8)*.7*(Math.pow(o+273,4)-Math.pow(i+273,4))-.072*.7*(34-i)-.054*(5.87-a),Math.max(-3,Math.min(3,s))}(a,s);return{config:t,temp:a,humidity:s,dewPoint:r,wetBulbTemp:f,enthalpy:m,waterContent:d,absoluteHumidity:g,specificVolume:y,pmv:v,moldRisk:x,inComfortZone:p(a,s,i)}}drawChart(t){const e=this.querySelector("#psychroChart");e&&(this.chartRenderer.setCanvas(e),this.chartRenderer.draw(this.validPoints,t))}setupEventListeners(){this.querySelectorAll(".clickable-value").forEach(t=>{t.addEventListener("click",t=>{const e=t.currentTarget,i=e.dataset.entity,o=e.dataset.type;i&&o&&this._hass&&this.showHistoryModal(i,o)})}),this.setupCanvasInteractivity()}setupCanvasInteractivity(){const t=this.querySelector("#psychroChart");t&&t.addEventListener("mousemove",e=>{const i=t.getBoundingClientRect(),o=e.clientX-i.left,n=e.clientY-i.top;let a=!1;for(const e of this.validPoints){const i=this.coordinateSystem.tempToX(e.temp),s=this.coordinateSystem.humidityToY(e.temp,e.humidity);if(Math.sqrt(Math.pow(o-i,2)+Math.pow(n-s,2))<10){t.style.cursor="pointer",a=!0;break}}a||(t.style.cursor="crosshair")})}showHistoryModal(t,e){console.log(`Show history for ${t} (${e})`)}setupResizeObserver(){this.resizeObserver||(this.resizeObserver=new ResizeObserver(function(t,e){let i=null;return function(...o){const n=this;i&&clearTimeout(i),i=setTimeout(()=>{t.apply(n,o),i=null},e)}}(()=>{this.updateCanvasSize()},150)),this.resizeObserver.observe(this))}updateCanvasSize(){const t=this.querySelector(".chart-container");if(!t)return;const e=t.clientWidth,i=Math.min(.75*e,600);this.canvasWidth=e,this.canvasHeight=i,this.coordinateSystem.setDimensions(e,i),this._hass&&this.render(this._hass)}connectedCallback(){this.setupResizeObserver()}disconnectedCallback(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),null!==this.resizeDebounceTimer&&(clearTimeout(this.resizeDebounceTimer),this.resizeDebounceTimer=null)}getCardSize(){return 3}static getStubConfig(){return{type:"custom:psychrometric-chart-enhanced",points:[{temp:"sensor.temperature",humidity:"sensor.humidity",color:"#ff0000",label:"Room"}]}}}const f="2.0.0";return customElements.define("psychrometric-chart-enhanced",g),console.info(`%cüå°Ô∏è Psychrometric Chart Card v${f} %c\nModular TypeScript architecture\nLoaded successfully!`,"color: #4CAF50; font-weight: bold; font-size: 14px;","color: #666; font-size: 12px;"),window.customCards=window.customCards||[],window.customCards.push({type:"psychrometric-chart-enhanced",name:"Psychrometric Chart",description:"Advanced psychrometric chart for HVAC monitoring",preview:!1,documentationURL:"https://github.com/guiohm79/diagram-psychro"}),t.NAME="psychrometric-chart-enhanced",t.PsychrometricCard=g,t.VERSION=f,t}({});
